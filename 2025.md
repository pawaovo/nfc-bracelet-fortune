微信小程序中引入和展示PAG动画的详细文档（2025版）

1. 概述
   PAG（腾讯PAG动效）是一套高性能动画渲染库，官方提供了小程序版本的SDK（libpag-miniprogram），支持在微信小程序中通过Canvas（WebGL）加载和展示pag动画文件。此方案广泛用于各大腾讯产品，性能稳定，功能完善。

2. 环境准备
   微信开发者工具最新版（支持npm管理）

小程序基础项目环境

具备npm命令行使用环境（可在命令行运行npm）

3. 操作步骤
   3.1 安装依赖包
   在小程序项目根目录打开命令行，执行：

bash
npm install libpag-miniprogram --save
在微信开发者工具菜单执行“工具” → “构建npm”，完成依赖构建。

3.2 准备WASM文件
进入node_modules/libpag-miniprogram/lib/目录，找到文件libpag.wasm.br

将该文件复制到项目的/utils/目录（或其他合适目录）

3.3 页面结构
在需要展示pag动画的页面wxml中添加如下canvas控件：

xml
<canvas type="webgl" id="pagCanvas" style="width: 100%; height: 400px;"></canvas>
3.4 页面逻辑
在js文件中，引入SDK并实现加载播放流程：

js
import { PAGInit } from 'libpag-miniprogram';

Page({
async onReady() {
// 初始化PAG SDK
this.PAG = await PAGInit({
locateFile: (file) => '/utils/' + file // wasm文件路径
});

    // 加载并播放动画
    await this.loadAndPlayPag();

},

async loadAndPlayPag() {
const query = wx.createSelectorQuery();
query.select('#pagCanvas').node().exec(async (res) => {
const canvas = res[0].node;

      // 加载pag文件二进制（可替换成你的pag文件URL）
      const pagBuffer = await this.loadPagFile('https://example.com/animation.pag');

      // 加载pag文件数据
      const pagFile = await this.PAG.PAGFile.load(pagBuffer);

      // 创建动画视图，绑定canvas
      this.pagView = await this.PAG.PAGView.init(pagFile, canvas);

      // 播放动画
      this.pagView.play();
    });

},

loadPagFile(url) {
return new Promise((resolve, reject) => {
wx.request({
url,
responseType: 'arraybuffer',
success(res) {
if (res.statusCode === 200) {
resolve(res.data);
} else {
reject('加载pag文件失败，状态码: ' + res.statusCode);
}
},
fail() {
reject('请求pag文件失败');
}
});
});
}
}); 4. 注意事项
WASM路径
locateFile必须正确指向libpag.wasm.br的路径，错误会导致PAG SDK初始化失败。

pag文件加载
由于小程序安全限制，不支持直接静态导入pag文件，需使用wx.request或wx.downloadFile异步获取二进制数据。

canvas类型
canvas必须使用type="webgl"，否则无法进行硬件加速的动画渲染。

动画控制
PAG支持播放控制（play()、pause()、stop()等），可保存pagView实例进行操作。

本地pag文件
本地pag文件需放在远程服务器或云存储，不能直接通过本地路径静态引用。

跨域问题
如果pag文件托管在第三方服务器，注意配置CORS允许小程序域名访问。

性能优化

只加载必要的pag资源，减少网络开销

使用canvas缓存或结合帧率控制减少渲染压力

动态替换
PAG SDK支持动态图层替换，例如文本和图片，可实现动画定制化。

5. 进阶功能参考
   文本动态替换：通过API动态修改动画中的文字内容

图片图层替换：动态替换动画中占位图片

多动画组合：通过多个PAGView实现复杂效果
