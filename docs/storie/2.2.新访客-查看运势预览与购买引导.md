# Story 2.2: 新访客 - 查看运势预览与购买引导

## Status

Draft

## Story

**As a** 已输入信息但未绑定手链的新访客,
**I want** 在运势结果页看到我的综合分数，并清晰地看到购买手链以解锁完整内容的引导,
**so that** 我了解产品价值并被引导去购买.

## Acceptance Criteria

1.  从信息补全页 (`pages/profile/index`) 成功提交后，正确展示**访客版**的“每日运势结果页” (`pages/fortune/index`)。
2.  访客版结果页顶部正确显示当天日期。
3.  结果页显示访客版欢迎语，格式为：“[用户称呼], 这是你的运势预览”。
4.  结果页清晰、突出地展示当日“综合分数”。
5.  除综合分数外，页面的其他运势详情区域（如一句话点评、分项运势、开运提示）均进行模糊处理或使用锁图标遮挡，用户无法看清具体内容。
6.  在模糊/遮挡区域显著位置，展示一个醒目的引导模块，包含引导文案（如：“购买专属NFC手链，即可解锁全部运势、历史记录和更多专属功能！”）和一个引导按钮（如：“前往解锁”）。
7.  点击“前往解锁”按钮，执行与 Story 2.3 的 AC 5-6 相同的操作（复制抖音链接并提示）。

## Tasks / Subtasks

- [ ] **Task 1: (前端) 实现运势结果页访客版视图 (AC: 1-5)**
  - [ ] 在 `pages/fortune/index.vue` 中，使用 `v-if` 或计算属性，根据页面 data/Pinia store 中的 `isAuth` 状态 (应为 `false`) 来渲染访客版视图。
  - [ ] 实现顶部日期和访客版欢迎语的展示。
  - [ ] 确保综合分数 (`fortuneData.score`) 清晰、突出显示。
  - [ ] 对其他运势详情区域（点评、分项运势、开运提示等）应用 CSS 模糊效果 (`filter: blur(Xpx);`) 或覆盖半透明遮罩层及锁图标。**确保模糊效果足以使内容不可读**。
- [ ] **Task 2: (前端) 实现解锁引导模块 (AC: 6, 7)**
  - [ ] 在访客版视图的模糊区域上方或中间，添加一个视觉突出的引导模块（例如，使用不同背景色或边框的 `view` 容器）。
  - [ ] 在模块内添加指定的引导文案。
  - [ ] 添加 "前往解锁" 按钮，并为其绑定点击事件 `handleUnlockClick`。
  - [ ] 实现 `handleUnlockClick` 函数：调用 Story 2.3 Task 3 中实现的 `copyDouyinLink` 辅助函数（或直接实现复制逻辑：获取抖音链接 -> `uni.setClipboardData` -> `uni.showToast` 提示）。
- [ ] **Task 3: (前端) 隐藏/禁用访客功能 (AC: 相关)**
  - [ ] 确保访客版视图中，“查看历史”入口被隐藏或置灰不可点击。
- [ ] **Task 4: (后端) 确保 `/fortune/today` 接口返回访客数据 (AC: 4, 5)**
  - [ ] 验证 Story 2.1 Task 5 中实现的 `/fortune/today` 逻辑：当用户未绑定手链时 (`isAuth: false`)，返回的 `fortune` 对象中，除了 `score` 字段外，其他运势详情字段（`comment`, `careerScore`, `wealthScore`, `loveScore`, `goodElement`, `luckyColor`, `goodFor` 等）要么不返回，要么返回 null 或空字符串，以便前端更容易处理模糊/隐藏逻辑。

## Dev Notes

- **前端**:
  - **核心页面**: `apps/wx-app/src/pages/fortune/index.vue`。
  - **状态**: 页面需要能接收或从 Pinia store 获取 `isAuth` 状态，并据此渲染不同 UI。
  - **UI**: 重点是实现清晰的综合分数展示、有效的模糊/遮挡效果、以及醒目的解锁引导模块。参考 `front-end-spec.md` 中的布局要求。
  - **交互**: “前往解锁”按钮需触发复制链接操作。
- **后端**:
  - **核心接口**: `GET /api/v1/fortune/today` 需要根据用户 `isAuth` 状态返回不同粒度的数据。
- **数据**: 前端需要正确处理后端返回的部分运势数据，并展示访客版界面。
- **编码标准**: 遵循 `docs/architecture/coding-standards.md`。

## Testing

- **前端单元测试 (Vitest)**:
  - 测试 `pages/fortune/index.vue` 在 `isAuth: false` 状态下的渲染：
    - 验证日期、访客欢迎语、综合分数是否正确显示。
    - 验证其他运势详情区域是否确实被模糊或隐藏。
    - 验证解锁引导模块和按钮是否存在且文本正确。
    - 验证“查看历史”按钮是否隐藏或禁用。
  - Mock `uni.setClipboardData`, `uni.showToast`。
  - 测试 `handleUnlockClick` 函数是否正确触发复制和提示。
- **后端单元测试 (Jest)**:
  - 重点验证 `FortunesService` 在处理未绑定用户请求时，返回的数据结构符合访客版要求（`isAuth: false`，运势详情字段为空或不存在）。
- **集成测试 (后端)**:
  - 使用一个**未绑定手链但已补全信息**的用户的 Token 调用 `GET /fortune/today`，验证返回 `isAuth: false` 且 `fortune` 对象中仅包含访客可见数据。
- **手动/E2E 测试 (uts)**:
  - **核心流程**: 模拟新访客完成信息输入后，验证进入的运势结果页：
    - 只有综合分数清晰可见。
    - 其他运势详情确实被模糊/遮挡。
    - 解锁引导模块醒目可见。
    - 点击“前往解锁”按钮能成功复制链接并看到提示。
    - “查看历史”按钮不可用。

## Change Log

| Date           | Version | Description | Author |
| :------------- | :------ | :---------- | :----- |
| 2025年10月24日 | 0.1     | 初始草稿    | SM     |
