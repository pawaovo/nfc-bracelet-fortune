# Story 1.0: 项目初始化与基础设置

## Status

Draft

## Story

**As a** 开发团队成员,
**I want** 初始化项目结构、配置开发环境、设置版本控制、配置基础数据库和 CI/CD 流水线，并准备初始商品数据与外部服务凭证,
**so that** 为后续的功能开发奠定坚实的基础.

## Acceptance Criteria

1.  项目代码库已基于选定的 uni-app starter template (Vue3+Vite+TS) 正确创建.
2.  项目已按照架构文档定义的 Monorepo 结构 (使用 pnpm workspaces) 进行组织 (`apps/wx-app`, `apps/api`, `packages/shared-types` 等目录已创建).
3.  运行 `pnpm install` 后，所有在技术栈 中定义的核心依赖均已正确安装到相应的 `package.json` 文件中.
4.  Git 仓库已初始化，包含一个合适的 `.gitignore` 文件，并且项目的初始状态已作为首次提交 (`Initial commit`) 推送到远程仓库.
5.  项目根目录下存在一个基础的 `README.md` 文件，包含项目简介、技术栈列表、**必要的外部服务凭证准备说明 (微信 AppID/Secret, AI API Key)**、以及本地开发环境启动说明（包括数据库启动说明和前后端启动命令）.
6.  前后端开发服务器可以通过 `package.json` 中定义的脚本命令成功启动.
7.  ESLint 和 Prettier 已配置在 Monorepo 根目录，并通过 `husky` 和 `lint-staged` 配置为在提交前自动检查/格式化代码.
8.  本地开发环境的 PostgreSQL 数据库可以通过 Docker Compose (`docker-compose up -d`) 或类似脚本轻松启动和连接。后端 API 服务的 `.env.example` 文件已包含连接本地数据库所需的变量.
9.  基础的 CI/CD 流水线 (例如 GitHub Actions 或 GitLab CI) 已配置，至少包含代码检出、依赖安装、Lint 检查和单元测试（前后端）阶段.
10. `products` 表的种子数据脚本已创建 (例如，使用 Prisma Seed)，并包含至少 3-5 条示例手链商品数据（含名称、描述、图片 URL 占位符、抖音链接占位符），可以通过命令 (`pnpm --filter api prisma db seed`) 执行填充.

## Tasks / Subtasks

- [ ] **Task 1: 初始化 Monorepo 环境 (AC: 2, 3)**
  - [ ] 在项目根目录初始化 pnpm (`pnpm init`)。
  - [ ] 配置 `pnpm-workspace.yaml` 文件，定义 `apps/*` 和 `packages/*`。
  - [ ] 在根目录 `package.json` 中添加必要的开发依赖（如 TypeScript, ESLint, Prettier, husky, lint-staged）。
  - [ ] 创建基础 `tsconfig.base.json`。
- [ ] **Task 2: 创建 `wx-app` 前端应用 (AC: 1, 2, 3)**
  - [ ] 使用 uni-app 官方 Vue3+Vite+TS 模板在 `apps/wx-app` 目录下创建项目。
  - [ ] 调整 `apps/wx-app/package.json` 和 `tsconfig.json` 以适应 Monorepo 结构（继承 `tsconfig.base.json`）。
  - [ ] 运行 `pnpm install` 确保前端依赖安装正确。
- [ ] **Task 3: 创建 `api` 后端应用 (AC: 2, 3)**
  - [ ] 使用 NestJS CLI 在 `apps/api` 目录下创建新项目 (`nest new api`)。
  - [ ] 调整 `apps/api/package.json` 和 `tsconfig.json` 以适应 Monorepo 结构。
  - [ ] 安装后端核心依赖 (NestJS 模块, Prisma Client, JWT 库等)。
  - [ ] 运行 `pnpm install` 确保后端依赖安装正确。
- [ ] **Task 4: 创建 `shared-types` 包 (AC: 2, 3)**
  - [ ] 在 `packages/shared-types` 目录下创建 `package.json` 和 `tsconfig.json`。
  - [ ] 创建 `src/index.ts` 作为导出入口。
  - [ ] 在 `apps/wx-app` 和 `apps/api` 的 `package.json` 中添加对 `shared-types` 的 workspace 依赖。
- [ ] **Task 5: 配置版本控制 (AC: 4)**
  - [ ] 初始化 Git 仓库 (`git init`)。
  - [ ] 创建 `.gitignore` 文件，忽略 `node_modules`, `.env`, build 输出等。
  - [ ] 执行首次提交 (`git add .`, `git commit -m "Initial commit"`）。
  - [ ] (用户操作) 关联到远程 Git 仓库并推送。
- [ ] **Task 6: 配置代码规范工具 (AC: 7)**
  - [ ] 在根目录配置 ESLint (`.eslintrc.js`) 和 Prettier (`.prettierrc`) 规则。
  - [ ] 配置 `husky` 和 `lint-staged` 以在 `pre-commit` 钩子中运行 Lint 和 Format。
  - [ ] 验证提交时自动检查/格式化生效。
- [ ] **Task 7: 配置本地数据库 (AC: 8)**
  - [ ] 在项目根目录或 `apps/api` 目录下创建 `docker-compose.yml` 文件，定义 PostgreSQL 服务。
  - [ ] 在 `apps/api` 目录下创建 `.env.example` 文件，包含数据库连接 URL 变量 (`DATABASE_URL`)。
  - [ ] 在 `README.md` 中添加启动本地数据库的说明 (`docker-compose up -d`)。
  - [ ] 配置 Prisma (`schema.prisma` 文件) 连接到数据库。
- [ ] **Task 8: 实现数据库种子数据 (AC: 10)**
  - [ ] 在 `apps/api/prisma/` 目录下创建 `seed.ts` 文件。
  - [ ] 在 `seed.ts` 中编写脚本，使用 Prisma Client 向 `products` 表插入 3-5 条示例数据。
  - [ ] 在 `apps/api/package.json` 中配置 `prisma.seed` 脚本 (`"prisma": {"seed": "ts-node prisma/seed.ts"}`)。
  - [ ] 验证 `pnpm --filter api prisma db seed` 命令可以成功执行。
- [ ] **Task 9: 添加开发启动脚本 (AC: 6)**
  - [ ] 在根目录 `package.json` 中添加脚本，用于同时或分别启动前后端开发服务器（例如 `dev:wx`, `dev:api`, `dev`）。
  - [ ] 确保脚本能正确运行 `pnpm --filter wx-app dev:mp-weixin` 和 `pnpm --filter api start:dev`。
- [ ] **Task 10: 创建基础 README (AC: 5)**
  - [ ] 在根目录创建 `README.md` 文件。
  - [ ] 添加项目简介、技术栈列表、外部服务凭证准备说明、本地开发启动步骤（包括 DB 和服务）。
- [ ] **Task 11: 配置基础 CI/CD (AC: 9)**
  - [ ] 在 `.github/workflows/` 或 `.gitlab-ci.yml` 中创建基础流水线配置文件。
  - [ ] 配置流水线触发条件（如 push 到 main 分支）。
  - [ ] 添加作业步骤：检出代码 -> 设置 Node.js/pnpm -> `pnpm install` -> `pnpm lint` -> `pnpm --filter wx-app test:unit` (假设有单元测试脚本) -> `pnpm --filter api test`。

## Dev Notes

- **项目结构**: 严格遵循 `docs/architecture/source-tree.md` 中定义的 Monorepo 结构。
- **技术栈**: 使用 `docs/architecture/tech-stack.md` 中定义的库和版本。
- **工具**: 使用 `pnpm` 进行依赖管理和脚本执行。使用 `Vite` 构建前端，`NestJS CLI` 管理后端。使用 `Prisma CLI` 管理数据库 Schema 和 Seed。
- **配置**: 所有配置文件（`tsconfig`, `eslint`, `prettier` 等）应放置在 Monorepo 根目录或各自包/应用内，并配置好继承关系。
- **外部凭证**: 提醒用户需要在本地 `.env` 文件 (基于 `.env.example`) 中配置好微信 AppID/Secret 和 AI API Key 才能完整运行。
- **编码标准**: 遵循 `docs/architecture/coding-standards.md`。

## Testing

- **单元测试**: 基础 CI 流水线应包含运行单元测试的步骤。确保 Vitest (前端) 和 Jest (后端) 的基础配置完成，可以运行（即使此时没有实际测试用例）。
- **Linting/Formatting**: CI 流水线应包含 Lint 检查步骤，确保代码符合规范。
- **手动验证**: 确保所有 AC 中描述的环境、脚本和命令都能按预期工作。

## Change Log

| Date           | Version | Description                               | Author |
| :------------- | :------ | :---------------------------------------- | :----- |
| 2025年10月24日 | 0.1     | 初始草稿，基于 PRD 和 Architecture 生成。 | SM     |
