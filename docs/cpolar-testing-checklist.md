# ✅ cpolar 内网穿透测试检查清单

## 📋 准备阶段

### 环境准备

- [ ] **安装 Docker Desktop**
  - [ ] 下载地址：https://www.docker.com/products/docker-desktop
  - [ ] 安装完成
  - [ ] 启动 Docker Desktop
  - [ ] 验证：`docker --version`

- [ ] **安装 cpolar**
  - [ ] 访问官网：https://www.cpolar.com/
  - [ ] 注册账号
  - [ ] 下载客户端
  - [ ] 安装完成
  - [ ] 验证：`cpolar version`

- [ ] **配置 cpolar**
  - [ ] 登录 cpolar 官网
  - [ ] 复制 authtoken
  - [ ] 运行：`cpolar authtoken <你的token>`
  - [ ] 验证配置成功

- [ ] **安装项目依赖**
  - [ ] 运行：`pnpm install`
  - [ ] 等待安装完成
  - [ ] 无错误提示

---

## 🚀 启动服务

### 方式一：使用启动脚本（推荐）

- [ ] **Windows 用户**
  - [ ] 双击运行：`start-cpolar-test.bat`
  - [ ] 等待所有服务启动
  - [ ] 从 cpolar 窗口复制 HTTPS 地址

- [ ] **Mac/Linux 用户**
  - [ ] 添加执行权限：`chmod +x start-cpolar-test.sh`
  - [ ] 运行：`./start-cpolar-test.sh`
  - [ ] 从终端输出复制 HTTPS 地址

### 方式二：手动启动

- [ ] **启动数据库**

  ```bash
  docker-compose up -d
  ```

  - [ ] 等待启动完成（约10秒）
  - [ ] 验证：`docker-compose ps`

- [ ] **启动后端服务**

  ```bash
  cd apps/api
  pnpm start:dev
  ```

  - [ ] 看到：`Application is running on: http://localhost:3000`
  - [ ] 保持窗口运行

- [ ] **启动 cpolar**
  ```bash
  cpolar http 3000
  ```

  - [ ] 看到：`Forwarding: https://xxx.cpolar.cn -> http://localhost:3000`
  - [ ] 复制 HTTPS 地址
  - [ ] 保持窗口运行

---

## ⚙️ 配置小程序

### 方式一：使用配置脚本（推荐）

- [ ] **运行配置脚本**
  ```bash
  node scripts/update-cpolar-url.js https://abc123.cpolar.cn
  ```

  - [ ] 替换为你的实际 cpolar 地址
  - [ ] 看到：`✅ 配置更新成功！`

### 方式二：手动配置

- [ ] **修改 API 配置**
  - [ ] 打开：`apps/wx-app/src/api/config.ts`
  - [ ] 找到第 13 行
  - [ ] 修改：`TUNNEL_BASE_URL: 'https://abc123.cpolar.cn'`
  - [ ] 找到第 25 行
  - [ ] 修改：`const CURRENT_ENV: EnvType = 'tunnel'`
  - [ ] 保存文件

- [ ] **关闭开发模式**
  - [ ] 打开：`apps/wx-app/src/config/dev-scenarios.ts`
  - [ ] 找到第 112 行
  - [ ] 修改：`enabled: false`
  - [ ] 保存文件

---

## 🔨 编译小程序

- [ ] **编译生产版本**

  ```bash
  cd apps/wx-app
  pnpm build:mp-weixin
  ```

  - [ ] 等待编译完成
  - [ ] 看到：`Build complete`
  - [ ] 无错误提示

- [ ] **验证编译输出**
  - [ ] 检查目录：`apps/wx-app/dist/build/mp-weixin`
  - [ ] 确认文件存在：`app.js`, `app.json`, `app.wxss`
  - [ ] 确认页面目录存在

---

## 📱 上传体验版

### 微信开发者工具

- [ ] **导入项目**
  - [ ] 打开微信开发者工具
  - [ ] 点击"导入项目"
  - [ ] 选择目录：`apps/wx-app/dist/build/mp-weixin`
  - [ ] AppID：`wx7ba4129d919fdf01`
  - [ ] 项目名称：手链运势
  - [ ] 点击"导入"

- [ ] **本地测试**
  - [ ] 查看页面是否正常显示
  - [ ] 打开控制台，查看日志
  - [ ] 看到：`🌐 内网穿透模式: https://xxx.cpolar.cn`
  - [ ] 测试 API 调用是否正常
  - [ ] 无错误提示

- [ ] **上传代码**
  - [ ] 点击工具栏"上传"按钮
  - [ ] 版本号：`1.0.0-cpolar-test`
  - [ ] 项目备注：`cpolar 内网穿透测试版本`
  - [ ] 点击"上传"
  - [ ] 等待上传完成

### 微信公众平台

- [ ] **设置体验版**
  - [ ] 登录：https://mp.weixin.qq.com
  - [ ] 进入：管理 → 版本管理
  - [ ] 找到刚上传的版本
  - [ ] 点击"设为体验版"
  - [ ] 确认设置

- [ ] **生成体验码**
  - [ ] 在"体验版"区域
  - [ ] 点击"体验二维码"
  - [ ] 下载或截图保存
  - [ ] 准备分享给测试用户

---

## 🧪 功能测试

### 基础功能

- [ ] **微信登录**
  - [ ] 扫码进入小程序
  - [ ] 看到隐私授权弹窗
  - [ ] 点击"同意"
  - [ ] 点击"微信登录"
  - [ ] 授权成功
  - [ ] 获取到用户信息

- [ ] **NFC 绑定**（模拟场景）
  - [ ] 进入绑定页面
  - [ ] 模拟 NFC 扫描
  - [ ] 绑定成功
  - [ ] 查看绑定状态

- [ ] **个人信息**
  - [ ] 填写姓名
  - [ ] 选择生日
  - [ ] 点击保存
  - [ ] 保存成功
  - [ ] 信息显示正确

- [ ] **运势生成**
  - [ ] 点击"生成运势"
  - [ ] 显示加载动画
  - [ ] 等待 AI 生成（10-30秒）
  - [ ] 显示运势内容
  - [ ] 内容完整且合理

- [ ] **历史记录**
  - [ ] 进入历史记录页面
  - [ ] 查看历史运势列表
  - [ ] 点击查看详情
  - [ ] 删除历史记录
  - [ ] 删除成功

- [ ] **隐私保护**
  - [ ] 首次进入显示隐私弹窗
  - [ ] 点击"隐私政策"
  - [ ] 查看隐私政策内容
  - [ ] 点击"用户协议"
  - [ ] 查看用户协议内容
  - [ ] 进入设置页面
  - [ ] 查看设置选项

### 性能测试

- [ ] **页面加载**
  - [ ] 首页加载时间 < 3秒
  - [ ] 页面切换流畅
  - [ ] 无明显卡顿

- [ ] **API 响应**
  - [ ] 登录接口 < 2秒
  - [ ] 绑定接口 < 2秒
  - [ ] 信息保存 < 2秒
  - [ ] AI 生成 < 30秒

- [ ] **网络稳定性**
  - [ ] 连续使用 10 分钟无断线
  - [ ] 多次刷新页面正常
  - [ ] 切换网络（WiFi/4G）正常

### 兼容性测试

- [ ] **iOS 系统**
  - [ ] iOS 14+
  - [ ] 微信版本 8.0+
  - [ ] 所有功能正常

- [ ] **Android 系统**
  - [ ] Android 8.0+
  - [ ] 微信版本 8.0+
  - [ ] 所有功能正常

---

## 👥 用户测试

### 邀请测试用户

- [ ] **准备测试**
  - [ ] 准备体验码
  - [ ] 准备测试说明
  - [ ] 准备反馈表单

- [ ] **邀请用户**
  - [ ] 邀请 5-10 个朋友
  - [ ] 发送体验码
  - [ ] 发送测试说明
  - [ ] 收集反馈

### 收集反馈

- [ ] **功能反馈**
  - [ ] 所有功能是否正常
  - [ ] 是否有 bug
  - [ ] 是否有崩溃

- [ ] **体验反馈**
  - [ ] 页面是否美观
  - [ ] 操作是否流畅
  - [ ] 文案是否清晰
  - [ ] 是否有改进建议

- [ ] **性能反馈**
  - [ ] 加载速度如何
  - [ ] 是否有卡顿
  - [ ] 网络是否稳定

---

## 🐛 问题处理

### 常见问题

- [ ] **cpolar 地址变化**
  - [ ] 重新运行 cpolar
  - [ ] 复制新地址
  - [ ] 运行：`node scripts/update-cpolar-url.js <新地址>`
  - [ ] 重新编译
  - [ ] 重新上传

- [ ] **连接超时**
  - [ ] 检查电脑是否休眠
  - [ ] 检查网络是否稳定
  - [ ] 检查后端服务是否运行
  - [ ] 检查 cpolar 是否运行

- [ ] **API 调用失败**
  - [ ] 查看后端日志
  - [ ] 查看小程序控制台
  - [ ] 检查 cpolar 地址是否正确
  - [ ] 检查数据库是否运行

---

## 📊 测试报告

### 测试总结

- [ ] **测试时间**
  - 开始时间：\_**\_年**月**日 **:\_\_
  - 结束时间：\_**\_年**月**日 **:\_\_
  - 总计时长：\_\_\_\_小时

- [ ] **测试人数**
  - 测试人数：\_\_\_\_ 人
  - 反馈人数：\_\_\_\_ 人
  - 反馈率：**\_**%

- [ ] **问题统计**
  - 严重问题：\_\_\_\_ 个
  - 一般问题：\_\_\_\_ 个
  - 建议：\_\_\_\_ 条

### 下一步计划

- [ ] **修复问题**
  - [ ] 修复严重问题
  - [ ] 修复一般问题
  - [ ] 优化用户体验

- [ ] **准备上线**
  - [ ] 选择部署方案
  - [ ] 完成备案（如需要）
  - [ ] 提交审核

---

## 🎯 完成标准

所有测试项目通过后，即可进入下一阶段：

✅ 所有基础功能正常
✅ 性能表现良好
✅ 用户反馈积极
✅ 无严重 bug

**恭喜！您可以准备正式上线了！** 🎉

---

## 📚 相关文档

- cpolar 使用指南：`docs/cpolar-testing-guide.md`
- 部署检查清单：`docs/deployment-checklist.md`
- 生产部署指南：`docs/production-deployment-guide.md`
