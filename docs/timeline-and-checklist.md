# 小程序上线时间线和检查清单

## 📅 完整时间线

```
第1天（今天）
├─ 购买域名和服务器
├─ 提交ICP备案申请
└─ 准备备案材料

第2-3天
├─ 等待域名实名认证
├─ 等待微信平台初审
└─ 继续开发功能（可选）

第4天
├─ 收到工信部短信
├─ 完成短信核验（24小时内）
└─ 进入通管局审核

第5-20天（备案审核期）
├─ 等待通管局审核
├─ 学习服务器部署知识
├─ 准备部署脚本
└─ 继续优化小程序功能

备案通过后（第1天）
├─ 收到备案号
├─ 部署PostgreSQL数据库
├─ 部署后端服务
└─ 配置Nginx + HTTPS

备案通过后（第2天）
├─ 修改小程序代码配置
├─ 编译生产版本
├─ 在微信公众平台配置域名
└─ 上传小程序代码

备案通过后（第3天）
├─ 提交小程序审核
└─ 等待审核结果

审核通过后（1-7天）
├─ 发布上线
├─ 监控服务运行
└─ 收集用户反馈
```

**总时间：约2-4周**

---

## ✅ 阶段一：备案准备（第1天）

### 任务清单

- [ ] **购买域名**
  - [ ] 访问阿里云/腾讯云/华为云
  - [ ] 搜索并购买域名（例如：nfc-fortune.com）
  - [ ] 完成域名实名认证（上传身份证）
  - [ ] 下载域名证书

- [ ] **购买服务器**
  - [ ] 选择配置：2核4G，40G硬盘
  - [ ] 选择地域：华北（北京）或华东（上海）
  - [ ] 选择操作系统：Ubuntu 22.04 LTS
  - [ ] 记录服务器IP地址

- [ ] **准备备案材料**
  - [ ] 身份证正反面照片（清晰、完整）
  - [ ] 手机号（本人实名认证）
  - [ ] 电子邮箱
  - [ ] 居住地址（详细到门牌号）

- [ ] **提交备案申请**
  - [ ] 登录微信公众平台
  - [ ] 进入"设置" → "小程序备案"
  - [ ] 填写主体信息
  - [ ] 填写网站信息
  - [ ] 上传材料
  - [ ] 提交审核

### 预计时间

- 购买域名和服务器：1小时
- 准备材料：30分钟
- 填写备案信息：1小时
- **总计：2.5小时**

---

## ✅ 阶段二：等待备案（第2-20天）

### 备案流程

```
提交备案
  ↓ (1-2天)
微信平台初审
  ↓ (收到短信)
短信核验（24小时内完成）
  ↓ (7-10天，最长20天)
通管局审核
  ↓
获得备案号
```

### 这期间可以做什么

#### 1. 继续开发功能（可选）

- [ ] 优化UI界面
- [ ] 添加新功能
- [ ] 修复已知bug
- [ ] 优化性能

#### 2. 学习部署知识

- [ ] 阅读 `docs/production-deployment-guide.md`
- [ ] 学习Linux基础命令
- [ ] 学习Nginx配置
- [ ] 学习PostgreSQL管理

#### 3. 准备部署环境

- [ ] 连接服务器（SSH）
- [ ] 更新系统软件包
- [ ] 安装Node.js、PostgreSQL、Nginx
- [ ] 配置防火墙

#### 4. 测试本地环境

- [ ] 在本地测试生产环境配置
- [ ] 确保所有功能正常
- [ ] 清理console.log
- [ ] 优化代码

### 重要提醒

⚠️ **收到工信部短信后，必须在24小时内完成短信核验！**

---

## ✅ 阶段三：备案通过后部署（第1-2天）

### 第1天：部署后端服务

- [ ] **连接服务器**

  ```bash
  ssh root@your-server-ip
  ```

- [ ] **安装环境**
  - [ ] 安装Node.js 20.x
  - [ ] 安装pnpm
  - [ ] 安装PM2
  - [ ] 安装PostgreSQL 15
  - [ ] 安装Nginx
  - [ ] 安装Certbot

- [ ] **部署数据库**
  - [ ] 创建数据库
  - [ ] 创建用户
  - [ ] 授予权限

- [ ] **部署后端**
  - [ ] 上传代码到服务器
  - [ ] 安装依赖（pnpm install）
  - [ ] 配置环境变量（.env.production）
  - [ ] 运行数据库迁移
  - [ ] 编译代码
  - [ ] 使用PM2启动服务

- [ ] **配置Nginx**
  - [ ] 创建Nginx配置文件
  - [ ] 配置反向代理
  - [ ] 测试配置
  - [ ] 重启Nginx

- [ ] **配置HTTPS**
  - [ ] 使用Certbot获取SSL证书
  - [ ] 测试HTTPS访问
  - [ ] 设置自动续期

- [ ] **测试后端服务**
  ```bash
  curl https://nfc-fortune.com/api/v1
  ```

### 预计时间：4-6小时

---

### 第2天：配置小程序

- [ ] **修改代码配置**
  - [ ] 修改 `apps/wx-app/src/api/config.ts`
  - [ ] 将 `PROD_BASE_URL` 改为 `https://nfc-fortune.com`
  - [ ] 检查其他配置

- [ ] **编译小程序**

  ```bash
  cd apps/wx-app
  pnpm build:mp-weixin
  ```

- [ ] **配置微信公众平台**
  - [ ] 登录微信公众平台
  - [ ] 进入"开发" → "开发管理" → "开发设置"
  - [ ] 配置服务器域名：
    - request合法域名：`https://nfc-fortune.com`
    - request合法域名：`https://ark.cn-beijing.volces.com`
  - [ ] 保存配置

- [ ] **上传小程序代码**
  - [ ] 打开微信开发者工具
  - [ ] 导入项目（dist/build/mp-weixin）
  - [ ] 测试功能
  - [ ] 点击"上传"
  - [ ] 填写版本号：1.0.0
  - [ ] 填写版本描述：初版上线

- [ ] **提交审核**
  - [ ] 登录微信公众平台
  - [ ] 进入"管理" → "版本管理"
  - [ ] 选择开发版本
  - [ ] 点击"提交审核"
  - [ ] 填写审核信息
  - [ ] 提交

### 预计时间：2-3小时

---

## ✅ 阶段四：等待审核（1-7天）

### 审核流程

```
提交审核
  ↓ (1-7天)
微信审核
  ↓
审核结果
```

### 审核期间

- [ ] 监控服务器运行状态
- [ ] 查看后端日志
- [ ] 准备审核可能的问题
- [ ] 准备用户反馈渠道

### 可能的审核结果

#### ✅ 审核通过

- [ ] 发布上线
- [ ] 监控服务运行
- [ ] 收集用户反馈
- [ ] 准备后续迭代

#### ❌ 审核被拒

常见拒绝原因及解决方案：

| 拒绝原因     | 解决方案                     |
| ------------ | ---------------------------- |
| 涉及封建迷信 | 修改文案，强调"仅供娱乐参考" |
| 缺少隐私政策 | 已添加，检查是否正常显示     |
| 域名未备案   | 检查备案号是否正确           |
| 功能无法使用 | 检查服务器是否正常运行       |
| 服务类目不符 | 修改服务类目为"生活服务"     |

---

## ✅ 阶段五：上线后维护

### 日常监控

- [ ] **每天检查**
  - [ ] 服务器运行状态
  - [ ] 后端服务状态（pm2 status）
  - [ ] 数据库连接数
  - [ ] 错误日志

- [ ] **每周检查**
  - [ ] 服务器资源使用（CPU、内存、硬盘）
  - [ ] 数据库备份
  - [ ] SSL证书有效期
  - [ ] 用户反馈

- [ ] **每月检查**
  - [ ] 更新系统软件包
  - [ ] 更新Node.js依赖
  - [ ] 清理日志文件
  - [ ] 优化数据库

### 备份策略

- [ ] **数据库备份**
  - [ ] 每天自动备份
  - [ ] 保留7天备份
  - [ ] 每周手动备份到本地

- [ ] **代码备份**
  - [ ] 使用Git版本控制
  - [ ] 每次更新打tag
  - [ ] 保留历史版本

---

## 📊 成本预算

### 一次性成本

| 项目     | 费用         | 说明 |
| -------- | ------------ | ---- |
| 域名     | 50-100元     | 首年 |
| **总计** | **50-100元** |      |

### 月度成本

| 项目     | 费用             | 说明         |
| -------- | ---------------- | ------------ |
| 服务器   | 300-500元        | 2核4G        |
| AI服务   | 0-100元          | 按使用量计费 |
| **总计** | **300-600元/月** |              |

### 年度成本

| 项目     | 费用               | 说明     |
| -------- | ------------------ | -------- |
| 域名续费 | 50-100元           | 每年     |
| 服务器   | 3600-6000元        | 12个月   |
| AI服务   | 0-1200元           | 按使用量 |
| **总计** | **3650-7300元/年** |          |

---

## 📞 紧急联系方式

### 服务商客服

- **阿里云**：95187
- **腾讯云**：95716
- **华为云**：4000-955-988

### 微信官方

- **微信公众平台**：https://mp.weixin.qq.com
- **微信开放社区**：https://developers.weixin.qq.com/community/

### 工信部

- **备案管理系统**：https://beian.miit.gov.cn
- **咨询电话**：010-66411166

---

## 🎯 关键里程碑

```
✅ 第1天：提交备案申请
✅ 第4天：完成短信核验
✅ 第10-20天：获得备案号
✅ 第21天：部署后端服务
✅ 第22天：提交小程序审核
✅ 第25-30天：审核通过，正式上线
```

---

## 📝 最终检查清单

### 代码检查

- [ ] 开发模式已关闭（DEV_CONFIG.enabled = false）
- [ ] 生产环境API地址已配置
- [ ] 所有console.log已清理或保留必要的
- [ ] 代码已编译打包无错误
- [ ] 所有功能测试通过

### 服务器检查

- [ ] 后端服务运行正常
- [ ] 数据库连接正常
- [ ] Nginx配置正确
- [ ] HTTPS证书有效
- [ ] 防火墙配置正确

### 微信平台检查

- [ ] ICP备案已完成
- [ ] 服务器域名已配置
- [ ] 隐私保护指引已填写
- [ ] 小程序基本信息已完善
- [ ] 服务类目已选择

### 内容检查

- [ ] 所有页面无敏感词汇
- [ ] 免责声明已添加
- [ ] 隐私政策内容完整
- [ ] 用户协议内容完整
- [ ] 备案号已添加到页面底部

---

## 🎉 恭喜！

如果你完成了以上所有步骤，你的小程序就可以正式上线了！

**祝你的小程序运营顺利！** 🚀
