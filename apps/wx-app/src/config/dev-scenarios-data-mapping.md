# 开发场景数据映射关系

本文档详细说明了开发场景配置与数据库种子数据之间的对应关系，确保每次重新生成数据后都能正常工作。

## 数据库种子数据概览

### 测试用户

| 数据库UUID     | wechatOpenId       | 姓名     | 生日       | 状态       |
| -------------- | ------------------ | -------- | ---------- | ---------- |
| 自动生成UUID_1 | dev_user_123       | 测试用户 | 1990-01-01 | 信息完整   |
| 自动生成UUID_2 | dev_user_456       | null     | null       | 信息不完整 |
| 自动生成UUID_3 | dev_other_user_789 | 其他用户 | 1985-06-15 | 信息完整   |

### 手链数据

| NFC ID                 | 绑定用户 | 绑定状态 | 用途                         |
| ---------------------- | -------- | -------- | ---------------------------- |
| NFC_OWNED_BY_USER_123  | user_123 | 已绑定   | 测试"已认证用户触碰自己手链" |
| NFC_BOUND_TO_OTHER_001 | user_789 | 已绑定   | 测试"触碰他人手链"场景       |
| NFC_BOUND_TO_OTHER_002 | user_789 | 已绑定   | 测试"触碰他人手链"场景       |
| NFC_FRESH_2025_001     | null     | 未绑定   | 测试"触碰未绑定手链"场景     |
| NFC_FRESH_2025_002     | null     | 未绑定   | 测试"触碰未绑定手链"场景     |
| NFC_FRESH_2025_003     | null     | 未绑定   | 测试"触碰未绑定手链"场景     |

## 开发场景详细对应关系

### 场景1：VISITOR_BOUND_NFC - 新访客触碰已绑定手链

- **NFC ID**: `NFC_BOUND_TO_OTHER_001`
- **手链状态**: 已被其他用户绑定
- **用户状态**: 未认证
- **预期流程**: 自动登录 → 返回 VISITOR_PREVIEW → 显示访客预览
- **数据库验证**: 手链绑定给 user_789，有对应运势数据

### 场景2：VISITOR_FRESH_NFC - 新访客触碰未绑定手链

- **NFC ID**: `NFC_FRESH_2025_001`
- **手链状态**: 未绑定
- **用户状态**: 未认证
- **预期流程**: 自动登录 → 绑定成功 → 跳转到个人信息补全页
- **数据库验证**: 手链未绑定，可以成功绑定给新用户

### 场景3：VISITOR_DIRECT - 新访客直接进入

- **NFC ID**: null
- **手链状态**: 无
- **用户状态**: 未认证
- **预期流程**: 静默登录 → 跳转到绑定页面
- **数据库验证**: 无需特定数据

### 场景4：AUTH_USER_OTHER_NFC - 已认证用户触碰他人手链

- **NFC ID**: `NFC_BOUND_TO_OTHER_002`
- **手链状态**: 已被其他用户绑定
- **用户状态**: 已认证（user_123）
- **预期流程**: 验证NFC → 返回非OWNER → 跳转到访客预览
- **数据库验证**: 手链绑定给 user_789，当前用户是 user_123

### 场景5：AUTH_USER_FRESH_NFC - 已认证用户触碰未绑定手链

- **NFC ID**: `NFC_FRESH_2025_002`
- **手链状态**: 未绑定
- **用户状态**: 已认证（user_123）
- **预期流程**: 验证NFC失败 → 自动登录绑定 → 跳转到运势页面
- **数据库验证**: 手链未绑定，可以绑定给当前用户

### 场景6：AUTH_USER_OWN_NFC - 已认证用户触碰自己手链

- **NFC ID**: `NFC_OWNED_BY_USER_123`
- **手链状态**: 已被当前用户绑定
- **用户状态**: 已认证（user_123）
- **预期流程**: 验证NFC → 返回OWNER → 跳转到运势页面
- **数据库验证**: 手链绑定给 user_123，当前用户也是 user_123

### 场景7：AUTH_USER_DIRECT - 已认证用户直接进入

- **NFC ID**: null
- **手链状态**: 无
- **用户状态**: 已认证（user_123）
- **预期流程**: 检查认证状态 → 直接跳转到运势页面
- **数据库验证**: 用户信息完整，有今日运势数据

### 场景8：INCOMPLETE_PROFILE - 信息不完整用户

- **NFC ID**: `NFC_FRESH_2025_003`
- **手链状态**: 未绑定
- **用户状态**: 已认证但信息不完整（user_456）
- **预期流程**: 绑定手链 → 跳转到个人信息补全页
- **数据库验证**: 用户姓名和生日为空

## 重新生成测试数据

如果需要重新生成测试数据，运行以下命令：

```bash
cd apps/api
pnpm db:seed
```

这将清理现有数据并重新创建所有测试数据。

## 注意事项

1. **开发模式下的微信认证**: 后端在开发模式下会模拟微信认证，不需要真实的微信code
2. **用户状态模拟**: 开发场景会在前端模拟用户登录状态，与后端数据保持一致
3. **NFC ID匹配**: 确保配置文件中的NFC ID与数据库中的数据完全匹配
4. **运势数据**: 已为测试用户创建了今日和昨日的运势数据，支持完整的运势查看功能

## 验证方法

1. 修改配置文件切换场景
2. 观察小程序日志，确认场景应用成功
3. 检查API调用是否返回预期结果
4. 验证页面跳转是否符合预期流程
